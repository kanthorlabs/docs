"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8669],{2106:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>u});var s=n(4848),r=n(8453);n(1470),n(9365);const a={title:"Quickstart",sidebar_label:"Quickstart",sidebar_position:1},i=void 0,o={id:"quickstart",title:"Quickstart",description:"To help you start working with KanthorQ, here's a guide on how to install the necessary packages, run database migrations, and begin publishing and subscribing to events in Go. This will walk you through setting up the core elements of KanthorQ and getting everything up and running.",source:"@site/docs/001-quickstart.md",sourceDirName:".",slug:"/quickstart",permalink:"/kanthorq/docs/quickstart",draft:!1,unlisted:!1,editUrl:"https://github.com/kanthorlabs/kanthorq/tree/main/packages/create-docusaurus/templates/shared/docs/001-quickstart.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Quickstart",sidebar_label:"Quickstart",sidebar_position:1},sidebar:"default",next:{title:"Guides",permalink:"/kanthorq/docs/category/guides"}},l={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Running migrations",id:"running-migrations",level:2},{value:"Sending Events with a Publisher",id:"sending-events-with-a-publisher",level:2},{value:"Handling Events with a Subscriber",id:"handling-events-with-a-subscriber",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"To help you start working with KanthorQ, here's a guide on how to install the necessary packages, run database migrations, and begin publishing and subscribing to events in Go. This will walk you through setting up the core elements of KanthorQ and getting everything up and running."}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(t.p,{children:"Before diving into KanthorQ, you\u2019ll need a PostgreSQL database. This can be a PostgreSQL instance running locally or in the cloud. Alternatively, you can use any database that supports the PostgreSQL wire protocol, such as CockroachDB or Amazon Aurora (PostgreSQL-compatible edition)."}),"\n",(0,s.jsx)(t.p,{children:"If you don\u2019t have a PostgreSQL instance running, you can quickly start one locally using Docker:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"docker run --name postgres -p 5432:5432 -e POSTGRES_PASSWORD=changemenow -d postgres:16\n"})}),"\n",(0,s.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsxs)(t.p,{children:["To install KanthorQ, make sure you're in a Go project directory (one that contains a ",(0,s.jsx)(t.code,{children:"go.mod"})," file). Then run the following command:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"go get github.com/kanthorlabs/kanthorq\n"})}),"\n",(0,s.jsx)(t.h2,{id:"running-migrations",children:"Running migrations"}),"\n",(0,s.jsx)(t.p,{children:"KanthorQ relies on PostgreSQL to manage its events and tasks. To set up the necessary database schema, you\u2019ll need to run some migrations. First, install the KanthorQ command-line tool:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"go install github.com/kanthorlabs/kanthorq/cmd/kanthorq@latest\n"})}),"\n",(0,s.jsx)(t.p,{children:"Next, run the migrations to set up KanthorQ\u2019s database schema:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"kanthorq migrate up -s 'github://kanthorlabs/kanthorq/migration#main' -d 'postgres://postgres:changemenow@localhost:5432/postgres?sslmode=disable'\n"})}),"\n",(0,s.jsx)(t.p,{children:"Make sure to replace the -d option with the URI of your PostgreSQL instance if you're using a different database setup."}),"\n",(0,s.jsx)(t.h2,{id:"sending-events-with-a-publisher",children:"Sending Events with a Publisher"}),"\n",(0,s.jsx)(t.p,{children:"Once the migration is complete, you\u2019re ready to start sending events using the publisher. Here\u2019s an example of how to publish events in Go:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:'import (\n\t"context"\n\n\t"github.com/kanthorlabs/kanthorq"\n\t"github.com/kanthorlabs/kanthorq/entities"\n\t"github.com/kanthorlabs/kanthorq/publisher"\n)\n\nfunc main() {\n\tctx := context.Background()\n\n\t// Initialize a publisher\n\tpub, cleanup := kanthorq.Pub(ctx, &publisher.Options{\n\t\t// Replace the connection string with your database URI\n\t\tConnection: "postgres://postgres:changemenow@localhost:5432/postgres?sslmode=disable",\n\t\t// Using the default stream for demo purposes\n\t\tStreamName: entities.DefaultStreamName,\n\t})\n\t// Clean up the publisher after use\n\tdefer cleanup()\n\n\tsubject := "system.say_hello"\n\tbody := []byte("{\\"msg\\": \\"Hello World!\\"}")\n\n\t// Define your first event\n\tevent := entities.NewEvent(subject, body)\n\n\tevents := []*entities.Event{\n\t\tevent,\n\t\t// Another  event\n\t\tentities.NewEvent("system.say_hello", []byte("{\\"msg\\": \\"I\'m comming!\\"}")),\n\t\t// And yet another event\n\t\tentities.NewEvent("system.say_goodbye", []byte("{\\"msg\\": \\"See you!!\\"}")),\n\t}\n\n\tif err := pub.Send(ctx, events); err != nil {\n\t\t// Handle error\n\t}\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:"In this example, you initialize a publisher that sends three events with different messages. The publisher handles event sending and interacts with the PostgreSQL database to persist those events."}),"\n",(0,s.jsx)(t.h2,{id:"handling-events-with-a-subscriber",children:"Handling Events with a Subscriber"}),"\n",(0,s.jsx)(t.p,{children:"Once you\u2019ve sent some events, you\u2019ll want to handle them using a subscriber. Here\u2019s a basic example of how to subscribe to events:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:'import (\n\t"context"\n\t"errors"\n\t"fmt"\n\t"log"\n\t"os"\n\t"os/signal"\n\t"syscall"\n\t"time"\n\n\t"github.com/kanthorlabs/kanthorq"\n\t"github.com/kanthorlabs/kanthorq/entities"\n\t"github.com/kanthorlabs/kanthorq/puller"\n\t"github.com/kanthorlabs/kanthorq/subscriber"\n)\n\nfunc main() {\n\t// Listen for SIGTERM, so pressing Ctrl-C stops the program\n\tctx, stop := signal.NotifyContext(context.TODO(), os.Interrupt, syscall.SIGINT, syscall.SIGTERM)\n\tdefer stop()\n\n\tvar options = &subscriber.Options{\n\t\t// Replace the connection string with your database URI\n\t\tConnection: "postgres://postgres:changemenow@localhost:5432/postgres?sslmode=disable",\n\t\t// Use the default stream for demo purposes\n\t\tStreamName: entities.DefaultStreamName,\n\t\t// Use the default consumer for demo purposes\n\t\tConsumerName: entities.DefaultConsumerName,\n\t\t// Receive only events matching the filter,\n\t\t// so that both system.say_hello and system.say_goodbye will be processed\n\t\tConsumerSubjectIncludes: []string{"system.>"},\n\t\t// Retry the task if it fails this many times\n\t\tConsumerAttemptMax: entities.DefaultConsumerAttemptMax,\n\t\t// Reprocess stuck tasks after this duration\n\t\tConsumerVisibilityTimeout: entities.DefaultConsumerVisibilityTimeout,\n\t\tPuller: puller.PullerIn{\n\t\t\t// Number of events to pull in one batch\n\t\t\tSize: 100,\n\t\t\t// Wait time before completing the batch if Size isn\u2019t reached\n\t\t\tWaitingTime: 1000,\n\t\t},\n\t}\n\n\t// Handle events; this goroutine will block until Ctrl-C is pressed\n\terr := kanthorq.Sub(ctx, options, func(ctx context.Context, msg *subscriber.Message) error {\n\t\tts := time.UnixMilli(msg.Event.CreatedAt).Format(time.RFC3339)\n\t\t// Print the received event\n\t\tfmt.Printf("RECEIVED: %s | %s | %s\\n", msg.Event.Id, msg.Event.Subject, ts)\n\t\treturn nil\n\t})\n\n\t// Print any errors, if applicable\n\tif err != nil && !errors.Is(err, context.Canceled) {\n\t\tlog.Fatal(err)\n\t}\n\n\tfmt.Println("----- END OF EXAMPLE ------")\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:["This example shows a subscriber listening for events matching the subject filter ",(0,s.jsx)(t.code,{children:"system.>"}),". The subscriber processes all events with subjects such as ",(0,s.jsx)(t.code,{children:"system.say_hello"})," or ",(0,s.jsx)(t.code,{children:"system.say_goodbye"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"After running the above example, you should see output similar to the following:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"2024/08/30 09:18:43 RECEIVED: event_01j6gh7t5v6j2q9ma0n78hw9fe | system.say_hello | 2024-08-30T09:18:42+07:00\n2024/08/30 09:18:43 RECEIVED: event_01j6gh7t5s973x2sby12j9pwkc | system.say_hello | 2024-08-30T09:18:42+07:00\n2024/08/30 09:18:45 RECEIVED: event_01j6gh7x3pvmk6demx3cq27j1q | system.say_goodbye | 2024-08-30T09:18:45+07:00\n"})}),"\n",(0,s.jsxs)(t.p,{children:["See the ",(0,s.jsx)(t.a,{href:"https://github.com/kanthorlabs/kanthorq/blob/main/example/default/main.go",children:"Defaule Subscriber example"})," for the complete code."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},9365:(e,t,n)=>{n.d(t,{A:()=>i});n(6540);var s=n(4164);const r={tabItem:"tabItem_Ymn6"};var a=n(4848);function i(e){let{children:t,hidden:n,className:i}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(r.tabItem,i),hidden:n,children:t})}},1470:(e,t,n)=>{n.d(t,{A:()=>w});var s=n(6540),r=n(4164),a=n(3104),i=n(6347),o=n(205),l=n(7485),u=n(1682),c=n(679);function h(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function d(e){const{values:t,children:n}=e;return(0,s.useMemo)((()=>{const e=t??function(e){return h(e).map((e=>{let{props:{value:t,label:n,attributes:s,default:r}}=e;return{value:t,label:n,attributes:s,default:r}}))}(n);return function(e){const t=(0,u.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function b(e){let{queryString:t=!1,groupId:n}=e;const r=(0,i.W6)(),a=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(r.location.search);t.set(a,e),r.replace({...r.location,search:t.toString()})}),[a,r])]}function p(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,a=d(e),[i,l]=(0,s.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:a}))),[u,h]=b({queryString:n,groupId:r}),[p,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,a]=(0,c.Dv)(n);return[r,(0,s.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:r}),f=(()=>{const e=u??p;return m({value:e,tabValues:a})?e:null})();(0,o.A)((()=>{f&&l(f)}),[f]);return{selectedValue:i,selectValue:(0,s.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),g(e)}),[h,g,a]),tabValues:a}}var g=n(2303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=n(4848);function y(e){let{className:t,block:n,selectedValue:s,selectValue:i,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,a.a_)(),c=e=>{const t=e.currentTarget,n=l.indexOf(t),r=o[n].value;r!==s&&(u(t),i(r))},h=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},t),children:o.map((e=>{let{value:t,label:n,attributes:a}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,ref:e=>l.push(e),onKeyDown:h,onClick:c,...a,className:(0,r.A)("tabs__item",f.tabItem,a?.className,{"tabs__item--active":s===t}),children:n??t},t)}))})}function x(e){let{lazy:t,children:n,selectedValue:r}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===r));return e?(0,s.cloneElement)(e,{className:"margin-top--md"}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==r})))})}function k(e){const t=p(e);return(0,v.jsxs)("div",{className:(0,r.A)("tabs-container",f.tabList),children:[(0,v.jsx)(y,{...t,...e}),(0,v.jsx)(x,{...t,...e})]})}function w(e){const t=(0,g.A)();return(0,v.jsx)(k,{...e,children:h(e.children)},String(t))}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var s=n(6540);const r={},a=s.createContext(r);function i(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);